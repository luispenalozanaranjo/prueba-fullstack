{"file":"mi-biblioteca-v_spenJC.js","mappings":"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","names":["_useModel","_ssrRenderAttrs","_mergeProps","_ssrInterpolate","_unref"],"sources":["../../../../components/ConfirmDialog.vue","../../../../stores/library.ts","../../../../pages/mi-biblioteca.vue"],"sourcesContent":["<script setup lang=\"ts\">\nconst show = defineModel<boolean>({ default:false });\nconst props = defineProps<{ message?: string }>();\nconst emit = defineEmits([\"confirm\",\"cancel\"]);\n</script>\n<template>\n  <div v-if=\"show\" style=\"position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.5);\">\n    <div class=\"card\" style=\"max-width:420px;\">\n      <p>{{ props.message || '¬øConfirmar?' }}</p>\n      <div style=\"display:flex; gap:8px; justify-content:flex-end;\">\n        <button class=\"button secondary\" @click=\"emit('cancel'); show=false\">Cancelar</button>\n        <button class=\"button danger\" @click=\"emit('confirm'); show=false\">Eliminar</button>\n      </div>\n    </div>\n  </div>\n</template>\n","// stores/library.ts\r\nimport { defineStore } from 'pinia'\r\nimport { useNuxtApp } from '#imports'   // o: import { useNuxtApp } from 'nuxt/app'\r\n\r\ntype FetchParams = {\r\n  q?: string\r\n  author?: string\r\n  excludeNoReview?: boolean\r\n  sort?: string\r\n}\r\n\r\nexport const useLibraryStore = defineStore('library', {\r\n  state: () => ({\r\n    items: [] as any[],\r\n    loading: false\r\n  }),\r\n  actions: {\r\n    // ‚Üê‚Üì‚Üì AQUI VA LO ROJO (fetch)\r\n    async fetch(params: FetchParams = {}) {\r\n      this.loading = true\r\n      try {\r\n        const { $api } = useNuxtApp()\r\n        const list = await $api('/books/my-library', {\r\n          method: 'GET',\r\n          query: {\r\n            q: params.q,\r\n            author: params.author,\r\n            // en el back se chequea excludeNoReview === \"true\"\r\n            excludeNoReview: params.excludeNoReview ? 'true' : undefined,\r\n            sort: params.sort\r\n          }\r\n        })\r\n        this.items = Array.isArray(list) ? list : []\r\n      } catch (err) {\r\n        console.error('[library.fetch] error', err)\r\n        throw err\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n\r\n    // ‚Üê‚Üì‚Üì Y AQUI VA LO ROJO (remove)\r\n    async remove(id: string) {\r\n      try {\r\n        const { $api } = useNuxtApp()\r\n        await $api(`/books/my-library/${encodeURIComponent(id)}`, {\r\n          method: 'DELETE'\r\n        })\r\n        // quitar localmente el elemento borrado\r\n        this.items = this.items.filter((it: any) => it.id !== id)\r\n      } catch (err) {\r\n        console.error('[library.remove] error', err)\r\n        throw err\r\n      }\r\n    }\r\n  }\r\n})\r\n","<script setup lang=\"ts\">\nimport { ref, watch } from 'vue';\nimport { onMounted as vueOnMounted } from 'vue';\n// Ajusta la ruta si es necesario\n// Ajusta la ruta si es necesario\nimport { useLibraryStore } from '../stores/library';\nimport { useRouter } from 'vue-router'\nconst router = useRouter()\n\nfunction onMounted(fn: () => Promise<void>) {\n  vueOnMounted(() => { fn(); });\n}\n\nconst store = useLibraryStore();\nconst q = ref(\"\");\nconst author = ref(\"\");\nconst exclude = ref(false);\nconst sort = ref(\"rating_desc\");\n\nasync function fetch(){\n  await store.fetch({\n    q: q.value || undefined,\n    author: author.value || undefined,\n    excludeNoReview: exclude.value,\n    sort: sort.value\n  });\n}\nonMounted(fetch);\nwatch([q, author, exclude, sort], fetch);\n\nconst showConfirm = ref(false);\nlet toDelete: string | null = null;\nfunction askDelete(id:string){ toDelete = id; showConfirm.value = true; }\nasync function confirmDelete(){ if (toDelete) await store.remove(toDelete); }\n\n// Asegura que el id siempre empiece con \"/\" y vaya URL-codificado (soporta \"works/OL...\" y \"%2Fworks%2FOL...\")\nfunction encodeId(raw: string) {\n  const s = raw?.startsWith('/') ? raw : `/${raw}`\n  return encodeURIComponent(s)\n}\n\nfunction goEdit(b: any) {\n  router.push({\n    path: `/libro/${encodeId(b.openLibraryId)}`,\n    query: {\n      // üëá MUY IMPORTANTE para que el detalle haga PUT:\n      dbId: b.id,\n      // Rellenos que ya usas en [id].vue:\n      title: b.title ?? '',\n      author: b.author ?? '',\n      year: b.year ?? '',\n      cover: b.coverBase64 ?? '',   // si ya tienes la portada en base64\n      review: b.review ?? '',            // ‚Üê opcional\n      rating: b.rating ?? ''             // ‚Üê opcional\n    }\n  })\n}\n</script>\n\n<template>\n  <div class=\"grid\" style=\"gap:16px;\">\n    <div class=\"card\" style=\"display:grid; gap:8px;\">\n      <strong>Buscar & Filtrar</strong>\n      <div class=\"grid\" style=\"grid-template-columns: 1fr 1fr 1fr 1fr; gap:8px;\">\n        <input class=\"input\" v-model=\"q\" placeholder=\"Buscar por t√≠tulo\" />\n        <input class=\"input\" v-model=\"author\" placeholder=\"Buscar por autor\" />\n        <select class=\"select\" v-model=\"sort\">\n          <option value=\"rating_desc\">Rating ‚Üì</option>\n          <option value=\"rating_asc\">Rating ‚Üë</option>\n        </select>\n        <label style=\"display:flex; align-items:center; gap:8px;\">\n          <input type=\"checkbox\" v-model=\"exclude\" /> Excluir sin review\n        </label>\n      </div>\n    </div>\n\n    <div v-if=\"store.loading\">Cargando...</div>\n    <div v-else-if=\"!store.items.length\" class=\"card\">No hay libros en tu biblioteca</div>\n    <div v-else class=\"grid books\">\n      <div class=\"card\" v-for=\"b in store.items\" :key=\"b.id\" style=\"display:grid; gap:8px;\">\n        <img v-if=\"b.coverBase64\" :src=\"b.coverBase64\" alt=\"portada\"\n             style=\"width:100%; aspect-ratio:2/3; object-fit:cover; border-radius:10px;\" />\n        <div>\n          <strong>{{ b.title }}</strong>\n          <div><small class=\"muted\">{{ b.author }} <span v-if=\"b.year\">¬∑ {{ b.year }}</span></small></div>\n          <div v-if=\"b.rating\">‚≠ê {{ b.rating }}/5</div>\n          <p v-if=\"b.review\">{{ b.review }}</p>\n        </div>\n        <div style=\"display:flex; gap:8px;\">\n          <!-- üëá AQUI usamos encodeId -->\n <button class=\"button secondary\" @click=\"goEdit(b)\">Editar</button>\n\n          <button class=\"button danger\" @click=\"askDelete(b.id)\">Eliminar</button>\n        </div>\n      </div>\n    </div>\n\n    <ConfirmDialog\n      v-model=\"showConfirm\"\n      message=\"¬øEliminar este libro de forma permanente?\"\n      @confirm=\"confirmDelete\"\n    />\n  </div>\n</template>\n"],"version":3}