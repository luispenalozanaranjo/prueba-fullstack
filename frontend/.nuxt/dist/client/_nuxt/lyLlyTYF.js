import{j as $,m as C,k as q,c as n,q as f,a as t,t as m,o as i,s as U,C as b,x as y,E as I,b as S,l as g,v as w,R as T,d as V,S as L,z as x,F as j,B as A,y as F,T as z}from"./BARFPmgz.js";const G={key:0,style:{position:"fixed",inset:"0",display:"grid","place-items":"center",background:"rgba(0,0,0,.5)"}},W={class:"card",style:{"max-width":"420px"}},H={style:{display:"flex",gap:"8px","justify-content":"flex-end"}},J=$({__name:"ConfirmDialog",props:C({message:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:C(["confirm","cancel"],["update:modelValue"]),setup(l,{emit:a}){const r=q(l,"modelValue"),u=l,c=a;return(v,d)=>r.value?(i(),n("div",G,[t("div",W,[t("p",null,m(u.message||"¿Confirmar?"),1),t("div",H,[t("button",{class:"button secondary",onClick:d[0]||(d[0]=p=>{c("cancel"),r.value=!1})},"Cancelar"),t("button",{class:"button danger",onClick:d[1]||(d[1]=p=>{c("confirm"),r.value=!1})},"Eliminar")])])])):f("",!0)}}),K=U("library",{state:()=>({items:[],loading:!1}),actions:{async fetch(l={}){this.loading=!0;try{const{$api:a}=b(),r=await a("/books/my-library",{method:"GET",query:{q:l.q,author:l.author,excludeNoReview:l.excludeNoReview?"true":void 0,sort:l.sort}});this.items=Array.isArray(r)?r:[]}catch(a){throw console.error("[library.fetch] error",a),a}finally{this.loading=!1}},async remove(l){try{const{$api:a}=b();await a(`/books/my-library/${encodeURIComponent(l)}`,{method:"DELETE"}),this.items=this.items.filter(r=>r.id!==l)}catch(a){throw console.error("[library.remove] error",a),a}}}}),O={class:"grid",style:{gap:"16px"}},P={class:"card",style:{display:"grid",gap:"8px"}},Q={class:"grid",style:{"grid-template-columns":"1fr 1fr 1fr 1fr",gap:"8px"}},X={style:{display:"flex","align-items":"center",gap:"8px"}},Y={key:0},Z={key:1,class:"card"},ee={key:2,class:"grid books"},te=["src"],oe={class:"muted"},se={key:0},ae={key:0},le={key:1},ne={style:{display:"flex",gap:"8px"}},ie=["onClick"],re=["onClick"],ue=$({__name:"mi-biblioteca",setup(l){const a=z();function r(o){F(()=>{o()})}const u=K(),c=y(""),v=y(""),d=y(!1),p=y("rating_desc");async function k(){await u.fetch({q:c.value||void 0,author:v.value||void 0,excludeNoReview:d.value,sort:p.value})}r(k),I([c,v,d,p],k);const h=y(!1);let _=null;function E(o){_=o,h.value=!0}async function B(){_&&await u.remove(_)}function N(o){const s=o!=null&&o.startsWith("/")?o:`/${o}`;return encodeURIComponent(s)}function R(o){a.push({path:`/libro/${N(o.openLibraryId)}`,query:{dbId:o.id,title:o.title??"",author:o.author??"",year:o.year??"",cover:o.coverBase64??"",review:o.review??"",rating:o.rating??""}})}return(o,s)=>{const D=J;return i(),n("div",O,[t("div",P,[s[7]||(s[7]=t("strong",null,"Buscar & Filtrar",-1)),t("div",Q,[g(t("input",{class:"input","onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e),placeholder:"Buscar por título"},null,512),[[w,c.value]]),g(t("input",{class:"input","onUpdate:modelValue":s[1]||(s[1]=e=>v.value=e),placeholder:"Buscar por autor"},null,512),[[w,v.value]]),g(t("select",{class:"select","onUpdate:modelValue":s[2]||(s[2]=e=>p.value=e)},s[5]||(s[5]=[t("option",{value:"rating_desc"},"Rating ↓",-1),t("option",{value:"rating_asc"},"Rating ↑",-1)]),512),[[T,p.value]]),t("label",X,[g(t("input",{type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=e=>d.value=e)},null,512),[[L,d.value]]),s[6]||(s[6]=V(" Excluir sin review ",-1))])])]),x(u).loading?(i(),n("div",Y,"Cargando...")):x(u).items.length?(i(),n("div",ee,[(i(!0),n(j,null,A(x(u).items,e=>(i(),n("div",{class:"card",key:e.id,style:{display:"grid",gap:"8px"}},[e.coverBase64?(i(),n("img",{key:0,src:e.coverBase64,alt:"portada",style:{width:"100%","aspect-ratio":"2/3","object-fit":"cover","border-radius":"10px"}},null,8,te)):f("",!0),t("div",null,[t("strong",null,m(e.title),1),t("div",null,[t("small",oe,[V(m(e.author)+" ",1),e.year?(i(),n("span",se,"· "+m(e.year),1)):f("",!0)])]),e.rating?(i(),n("div",ae,"⭐ "+m(e.rating)+"/5",1)):f("",!0),e.review?(i(),n("p",le,m(e.review),1)):f("",!0)]),t("div",ne,[t("button",{class:"button secondary",onClick:M=>R(e)},"Editar",8,ie),t("button",{class:"button danger",onClick:M=>E(e.id)},"Eliminar",8,re)])]))),128))])):(i(),n("div",Z,"No hay libros en tu biblioteca")),S(D,{modelValue:h.value,"onUpdate:modelValue":s[4]||(s[4]=e=>h.value=e),message:"¿Eliminar este libro de forma permanente?",onConfirm:B},null,8,["modelValue"])])}}});export{ue as default};
